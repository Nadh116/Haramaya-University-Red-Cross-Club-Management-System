<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-900">
            <i class="fas fa-sign-in-alt text-red-600 mr-2"></i>
            Admin Login Test
        </h1>

        <form id="loginForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="email" value="admin@haramaya.edu.et"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                <input type="password" id="password" value="admin123"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
            </div>

            <button type="submit" id="loginBtn"
                class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                <i class="fas fa-sign-in-alt mr-2"></i>
                Test Login
            </button>
        </form>

        <div id="result" class="mt-6 hidden"></div>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <h3 class="font-semibold text-gray-900 mb-2">Test Credentials:</h3>
            <div class="text-sm text-gray-600 space-y-1">
                <p><strong>Admin:</strong> admin@haramaya.edu.et / admin123</p>
                <p><strong>Officer:</strong> meron.tadesse@haramaya.edu.et / officer123</p>
                <p><strong>Member:</strong> sara.ahmed@student.haramaya.edu.et / member123</p>
            </div>
        </div>

        <div class="mt-4 text-center">
            <a href="http://localhost:3002/login" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                <i class="fas fa-external-link-alt mr-1"></i>
                Open React Login Page
            </a>
        </div>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            const loginBtn = document.getElementById('loginBtn');

            // Show loading
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
            loginBtn.disabled = true;
            resultDiv.className = 'mt-6 p-4 rounded-lg';
            resultDiv.style.display = 'block';

            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.className += ' bg-green-50 border border-green-200 text-green-700';
                    resultDiv.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-2"></i>
                            <strong>Login Successful!</strong>
                        </div>
                        <div class="mt-2 text-sm">
                            <p><strong>User:</strong> ${data.user.firstName} ${data.user.lastName}</p>
                            <p><strong>Role:</strong> ${data.user.role}</p>
                            <p><strong>Email:</strong> ${data.user.email}</p>
                            <p><strong>Token:</strong> ${data.token.substring(0, 50)}...</p>
                        </div>
                        <div class="mt-3">
                            <a href="http://localhost:3002/login" target="_blank" 
                               class="inline-flex items-center px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                <i class="fas fa-external-link-alt mr-1"></i>
                                Try React Login
                            </a>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || 'Login failed');
                }
            } catch (error) {
                resultDiv.className += ' bg-red-50 border border-red-200 text-red-700';
                resultDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <strong>Login Failed!</strong>
                    </div>
                    <div class="mt-2 text-sm">
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Check:</strong></p>
                        <ul class="list-disc list-inside mt-1">
                            <li>Backend server running on port 5000</li>
                            <li>Database connection working</li>
                            <li>Admin user exists in database</li>
                        </ul>
                    </div>
                `;
            } finally {
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Test Login';
                loginBtn.disabled = false;
            }
        });

        // Test backend connectivity on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('http://localhost:5000/api/health');
                const data = await response.json();
                console.log('Backend Status:', data);
            } catch (error) {
                console.error('Backend not accessible:', error);
            }
        });
    </script>
</body>

</html>